(self.webpackJsonpRuntime=self.webpackJsonpRuntime||[]).push([[191],{9191:(e,t,r)=>{"use strict";r.r(t),r.d(t,{PROVIDERS:()=>w,PROVIDERS_API:()=>f,changeState:()=>p,init:()=>m});var i=r(8127),s=r(2543),n=r(5617),o=r(8665);let a=null;var c=r(3848),d=r(6856),u=r(6559);const h={};let l={};function m(e){return Array.from(document.querySelectorAll(".dmSignup")).forEach((e=>{h[e.id]&&h[e.id].removeEventListeners(),h[e.id]=new v({container:e})})),h[(e||{}).id]||{}}function p(e,t){l=h[e],l.identityProvider===t||"default"===l.identityProvider&&l.defaultCurrentVaritation===t||(h[e].initStates(t),h[e].changeState(t))}const w=["okta","azuread","auth0"],f=["oktaApi","auth0Api"],S={empty:{},signup:{},login:{},resetPassword:{},chooseNewPassword:{},newPasswordSuccess:{},resetPasswordCheckEmail:{}};class v{constructor({container:e}){l=e;const t=l.querySelector("#runtime-model");this.identityProvider=l.getAttribute("provider"),this.defaultCurrentVaritation=l.getAttribute("defaultCurrentVariation"),this.runtimeModel=JSON.parse(i.Base64.decode(t.dataset.runtimeModel)),this.searchParams=function(e){const t={},r=("?"===e[0]?e.substr(1):e).split("&");for(const e of r){const r=e.split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")}return t}(window.location.search),this.signupStateVariation=this.runtimeModel.statesVariation,this.initStates(this.identityProvider),this.initInitialState(this.identityProvider),this.bindMethods()}changeState(e){this.hideAll(),S[e].div.style.display="flex"}hideAll(){for(const e in S)S[e].hasOwnProperty("div")&&null!==S[e].div&&(S[e].div.style.display="none")}bindMethods(){this.changeState=this.changeState.bind(this),this.hideAll=this.hideAll.bind(this),this.handleSubmitForm=this.handleSubmitForm.bind(this),this.addEventListener=this.addEventListener.bind(this),this.initStates=this.initStates.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.handleSignupFormSubmit=this.handleSignupFormSubmit.bind(this),this.handleLoginFormSubmit=this.handleLoginFormSubmit.bind(this),this.handleResetPasswordSubmit=this.handleResetPasswordSubmit.bind(this),this.initInitialState=this.initInitialState.bind(this)}removeEventListeners(){for(const e in S)S[e].hasOwnProperty("links")&&S[e].links.forEach((e=>{e.element.removeEventListener("touchstart",(t=>{t.preventDefault(),e.callback()})),e.element.removeEventListener("click",(t=>{t.preventDefault(),e.callback()}))}));"default"===this.runtimeModel.statesVariation.toLowerCase()&&(this.signupForm.removeEventListener("submit",(async e=>{e.preventDefault(),await this.handleSignupFormSubmit()})),this.loginForm.removeEventListener("submit",(async e=>{e.preventDefault(),await this.handleLoginFormSubmit()})),this.resetPasswordForm.removeEventListener("submit",(async e=>{e.preventDefault(),await this.handleResetPasswordSubmit()})))}initStates(e){"default"===e&&(this.initEmptyState(),this.signupForm=l.querySelector(".signup-form"),this.loginForm=l.querySelector(".login-form"),this.resetPasswordStateDiv=l.querySelector(".reset-password-state"),this.resetPasswordForm=this.resetPasswordStateDiv.querySelector(".reset-password-form"),this.initSignupState(),this.initLoginState(),this.initResetPasswordState(),this.initResetPasswordCheckEmailState(),this.initChooseNewPasswordState(),this.initNewPasswordSuccessState()),w.includes(e)&&this.initProviderOidcState(e),f.includes(e)&&this.initProviderApiState(e)}initInitialState(e){if("default"===e.toLowerCase()){if("reset"===this.searchParams.type){if(this.searchParams.success)return void this.changeState("newPasswordSuccess");if(this.searchParams.token)return void this.changeState("chooseNewPassword");if("invalid-token"===this.searchParams.error)return void this.changeState("resetPassword")}const e=l.getAttribute("default-state").toLowerCase();this.changeState(e)}else this.changeState(e)}initEmptyState(){S.empty.div=l.querySelector(".empty-state")}initResetPasswordState(){S.resetPassword.div=this.resetPasswordStateDiv,S.resetPassword.links=[{element:this.resetPasswordStateDiv.querySelector(".go-to-login-section"),callback:()=>this.changeState("login")}],"reset"===this.searchParams.type&&"invalid-token"===this.searchParams.error&&(this.resetPasswordStateDiv.querySelector(".form-description").textContent=this.runtimeModel.resetPasswordInvalidTokenDescription),S.resetPassword.links.map((e=>this.addEventListener(e)));const e=this.resetPasswordStateDiv.querySelector("#email"),t=()=>{e.setCustomValidity(this.runtimeModel.formUserNotExistsErrorText),e.reportValidity()};e.addEventListener("keyup",(0,s.debounce)((r=>{r.preventDefault(),this.validateUserExistence({inputField:e,onUserNotExists:t})}),400)),this.resetPasswordForm.addEventListener("submit",(async e=>{e.preventDefault(),await this.handleResetPasswordSubmit()}))}initSignupState(){this.loginLink=l.querySelector(".login-link"),this.signupStateDiv=l.querySelector(".signup-state"),S.signup.div=this.signupStateDiv,S.signup.links=[{element:this.loginLink,callback:()=>this.changeState("login")}],S.signup.links.map((e=>this.addEventListener(e))),this.signupForm.addEventListener("submit",(async e=>{e.preventDefault(),await this.handleSignupFormSubmit()}));const e=this.signupForm.querySelector("#email"),t=()=>{e.setCustomValidity(this.runtimeModel.formUserExistErrorText),e.reportValidity()};e.addEventListener("keyup",(0,s.debounce)((r=>{r.preventDefault(),this.validateUserExistence({inputField:e,onUserExists:t})}),400)),this.initPasswordButton(this.signupForm)}initLoginState(){this.loginStateDiv=l.querySelector(".login-state"),this.forgotPasswordLink=l.querySelector(".forgot-password-link"),this.notAMemberLink=l.querySelector(".not-a-member-link"),S.login.div=this.loginStateDiv,S.login.links=[{element:this.notAMemberLink,callback:()=>this.changeState("signup")},{element:this.forgotPasswordLink,callback:()=>this.changeState("resetPassword")}],S.login.links.map((e=>this.addEventListener(e))),this.loginForm.addEventListener("submit",(async e=>{e.preventDefault(),await this.handleLoginFormSubmit()})),this.initPasswordButton(this.loginForm)}initResetPasswordCheckEmailState(){this.resetPasswordCheckEmailStateDiv=l.querySelector(".reset-password-check-email-state"),S.resetPasswordCheckEmail.div=this.resetPasswordCheckEmailStateDiv,S.resetPasswordCheckEmail.links=[{element:this.resetPasswordCheckEmailStateDiv.querySelector(".go-to-login-section"),callback:()=>this.changeState("login")}],S.resetPasswordCheckEmail.links.map((e=>this.addEventListener(e)))}initChooseNewPasswordState(){this.chooseNewPasswordStateDiv=l.querySelector(".choose-new-password-state"),S.chooseNewPassword.div=this.chooseNewPasswordStateDiv,this.searchParams.token&&(this.chooseNewPasswordStateDiv.querySelector("#token").value=this.searchParams.token)}initNewPasswordSuccessState(){this.newPasswordSuccessStateDiv=l.querySelector(".new-password-success-state"),this.goToSiteBtn=this.newPasswordSuccessStateDiv.querySelector("#go-to-site-btn"),S.newPasswordSuccess.div=this.newPasswordSuccessStateDiv,this.goToSiteBtn.addEventListener("click",(async e=>{e.preventDefault(),await this.handleGoToSiteRequest()}),!1)}initPasswordButton(e){const t=e.querySelector("#password"),r=e.querySelector(".show-button"),i=e.querySelector("#show-password-button"),s=e.querySelector("#show-password-icon"),n=e.querySelector("#show-password-off-icon");t.addEventListener("input",(e=>{e.target.value?r.style.display="flex":r.style.display="none"})),i.addEventListener("change",(e=>{e.target.checked?(t.type="text",n.style.display="block",s.style.display="none"):(t.type="password",n.style.display="none",s.style.display="block")}))}initProviderOidcState(e){S[e]={},S[e].div=l.querySelector(`.${e}-state`),y(S[e].div.querySelector(".auth-error"),""),"access_denied"===this.searchParams.error&&y(S[e].div.querySelector(".auth-error"),this.runtimeModel.providerAccessDeniedErrorText)}initProviderApiState(e){S[e]={},S[e].form=l.querySelector(`.${e}-form`),S[e].div=l.querySelector(`.${e}-state`);const t=S[e].div.querySelector(".form-error");y(t,""),"access_denied"===this.searchParams.error?y(t,this.runtimeModel.providerAccessDeniedErrorText):"invalid_credentials"===this.searchParams.error?y(t,this.runtimeModel.formIncorrectCredentialsText):"true"===this.searchParams.error&&y(t,this.runtimeModel.formErrorText),this.initPasswordButton(S[e].form)}validateUserExistence({inputField:e,onUserExists:t,onUserNotExists:r}){if(e.setCustomValidity(""),e.value.length&&e.validity.valid&&!this.isInPreviewMode()){const i=`/rts/auth/public/users/${e.value}`;(0,u.e)({url:i}).then((()=>{t&&t()})).catch((e=>{e.status&&404!==e.status?n.C_.warn({message:"Error getting a user",error:e}):r&&r()}))}}addEventListener({element:e,callback:t}){e.addEventListener("touchstart",(e=>{e.preventDefault(),t()})),e.addEventListener("click",(e=>{e.preventDefault(),t()}))}async handleSignupFormSubmit(){y(this.signupForm.querySelector(".form-error"),""),await this.handleSubmitForm(this.signupForm,"/rts/auth/public/user",g,(()=>{y(this.signupForm.querySelector(".form-error"),this.runtimeModel.formErrorText)}))}async handleResetPasswordSubmit(){y(this.resetPasswordForm.querySelector(".form-error"),""),await this.handleSubmitForm(this.resetPasswordForm,"/rts/auth/public/users/resetPassword",(()=>{this.changeState("resetPasswordCheckEmail")}),(()=>{y(this.resetPasswordForm.querySelector(".form-error"),this.runtimeModel.formErrorText)}))}async handleLoginFormSubmit(){y(this.loginForm.querySelector(".form-error"),"");const e=this.loginForm.querySelectorAll("#password-field,#username");e.forEach((e=>e.classList.remove("invalid-input"))),this.handleSubmitForm(this.loginForm,"/rts/auth/login",g,(t=>{if(401===t.status)return e.forEach((e=>e.classList.add("invalid-input"))),void y(this.loginForm.querySelector(".form-error"),this.runtimeModel.formIncorrectCredentialsText);y(this.loginForm.querySelector(".form-error"),this.runtimeModel.formErrorText)}))}async handleGoToSiteRequest(){const e=window.Parameters.HomeUrl;window.location.assign(e)}async handleSubmitForm(e,t,r,i){const s=e.querySelector("input[type='submit']");s.disabled=!0;try{if((0,c.DD)())return;this.isInPreviewMode()?await async function(e){try{g(await fetch("/ms/auth/public/preview/authorize",{method:"GET",redirect:"follow"}))}catch(t){n.C_.info({message:"error in preview",error:t}),e(t)}}(i):await async function(e,t,r,i){const s=(0,d.V)("ecom.monolith.signup.widget.js.creds.via.body",!1),c=await async function(e){let t="";return window.friendlyChallenge?t=function(e){const t=e.querySelector(".frc-captcha-solution");return t&&t.getAttribute("value")}(e):window.grecaptcha&&(t=await async function(){window.captchaPromise=new o.c,window.grecaptcha.execute(),function(){const e=[...document.getElementsByTagName("iframe")].find((e=>e.src?.includes("google.com/recaptcha/api2/bframe")))?.parentNode?.parentNode;e&&(a=new MutationObserver((function(e){e.forEach((e=>{"attributes"===e.type&&"style"===e.attributeName&&"0"===e.target.style.opacity&&(a&&a.disconnect(),window.grecaptcha.reset(),window.captchaPromise.resolve(null))}))})),a.observe(e,{attributes:!0,attributeFilter:["style"]}))}();const e=await window.captchaPromise;return window.grecaptcha.reset(),a&&a.disconnect(),e}()),t}(e),u=s?function(e,t=""){const r=new FormData(e),i=r.has(P)?P:r.has(b)?b:"";return i?encodeURIComponent(i)+"="+encodeURIComponent(t)+`&isInvisibleCaptcha=${E(i)}`:""}(e,c):function(e,t=""){return[...new FormData(e).entries()].map((([e,r])=>e===P||e===b?encodeURIComponent(e)+"="+encodeURIComponent(t)+`&isInvisibleCaptcha=${E(e)}`:encodeURIComponent(e)+"="+encodeURIComponent(r))).join("&")}(e,c),h=u?`${t}?${u}`:t;try{const t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}};s&&(t.body=function(e){const t=new FormData(e);t.delete(P),t.delete(b);const r=new URLSearchParams;for(const[e,i]of t)r.append(e,i);return r.toString()}(e));const n=await fetch(h,t);n.status>=200&&n.status<=400?r(n):i(n)}catch(e){n.C_.warn({dataString:{message:"Error handling signup widget form",error:e}}),i(e)}}(e,t,r,i)}finally{s.disabled=!1}}isInPreviewMode(){return this.runtimeModel.isInPreview}}function g(e){e.redirected&&window.location.assign(e.url)}function y(e,t){e.style.display=t?"block":"none",e.textContent=t}const b="frc-captcha-solution",P="g-recaptcha-response";function E(e){return!e.includes(b)&&e.includes(P)}},8127:function(e,t,r){var i,s;s="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:this,e.exports=function(r){"use strict";var s,n=(r=r||{}).Base64,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=function(e){for(var t={},r=0,i=e.length;r<i;r++)t[e.charAt(r)]=r;return t}(o),c=String.fromCharCode,d=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},u=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,h=function(e){return e.replace(u,d)},l=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[o.charAt(r>>>18),o.charAt(r>>>12&63),t>=2?"=":o.charAt(r>>>6&63),t>=1?"=":o.charAt(63&r)].join("")},m=r.btoa&&"function"==typeof r.btoa?function(e){return r.btoa(e)}:function(e){if(e.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return e.replace(/[\s\S]{1,3}/g,l)},p=function(e){return m(h(String(e)))},w=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,"")},f=function(e,t){return t?w(p(e)):p(e)};r.Uint8Array&&(s=function(e,t){for(var r="",i=0,s=e.length;i<s;i+=3){var n=e[i],a=e[i+1],c=e[i+2],d=n<<16|a<<8|c;r+=o.charAt(d>>>18)+o.charAt(d>>>12&63)+(void 0!==a?o.charAt(d>>>6&63):"=")+(void 0!==c?o.charAt(63&d):"=")}return t?w(r):r});var S,v=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,g=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},y=function(e){return e.replace(v,g)},b=function(e){var t=e.length,r=t%4,i=(t>0?a[e.charAt(0)]<<18:0)|(t>1?a[e.charAt(1)]<<12:0)|(t>2?a[e.charAt(2)]<<6:0)|(t>3?a[e.charAt(3)]:0),s=[c(i>>>16),c(i>>>8&255),c(255&i)];return s.length-=[0,0,2,1][r],s.join("")},P=r.atob&&"function"==typeof r.atob?function(e){return r.atob(e)}:function(e){return e.replace(/\S{1,4}/g,b)},E=function(e){return P(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},F=function(e){return String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,"")},C=function(e){return function(e){return y(P(e))}(F(e))};r.Uint8Array&&(S=function(e){return Uint8Array.from(E(F(e)),(function(e){return e.charCodeAt(0)}))});if(r.Base64={VERSION:"2.6.4",atob:E,btoa:m,fromBase64:C,toBase64:f,utob:h,encode:f,encodeURI:function(e){return f(e,!0)},btou:y,decode:C,noConflict:function(){var e=r.Base64;return r.Base64=n,e},fromUint8Array:s,toUint8Array:S},"function"==typeof Object.defineProperty){var k=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};r.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",k((function(){return C(this)}))),Object.defineProperty(String.prototype,"toBase64",k((function(e){return f(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",k((function(){return f(this,!0)})))}}return r.Meteor&&(Base64=r.Base64),e.exports?e.exports.Base64=r.Base64:void 0===(i=function(){return r.Base64}.apply(t,[]))||(e.exports=i),{Base64:r.Base64}}(s)}}]);